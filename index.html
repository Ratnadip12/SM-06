<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bluetooth Pulse Sensor</title>
</head>
<body>

<h1>Pulse Sensor Data (Bluetooth)</h1>
<p>Pulse Rate (BPM): <span id="pulseRate">Waiting for data...</span></p>

<button id="connectButton">Connect to Bluetooth Device</button>
<div id="status">Disconnected</div>

<script>
  let bluetoothDevice;
  let server;
  let service;
  let characteristic;
  let reader;

  // Check if the Web Bluetooth API is supported
  if ('bluetooth' in navigator) {
    console.log("Web Bluetooth API is supported!");
  } else {
    alert("Web Bluetooth API is not supported by your browser.");
  }

  // Handle the connect button click
  document.getElementById('connectButton').addEventListener('click', async () => {
    try {
      // Request Bluetooth device (e.g., HC-05)
      bluetoothDevice = await navigator.bluetooth.requestDevice({
        filters: [{ services: ['battery_service'] }] // You can add specific UUIDs for your service
      });

      // Connect to the device and get the GATT server
      server = await bluetoothDevice.gatt.connect();

      // Get a Bluetooth service (replace with actual service UUID if needed)
      service = await server.getPrimaryService('battery_service'); // Example service

      // Get a Bluetooth characteristic (replace with actual characteristic UUID if needed)
      characteristic = await service.getCharacteristic('battery_level'); // Example characteristic

      document.getElementById('status').textContent = "Connected to Bluetooth Device";

      // Start reading data from the Bluetooth characteristic
      readBluetoothData();
    } catch (error) {
      console.error("Error connecting to Bluetooth device: ", error);
      document.getElementById('status').textContent = "Failed to connect";
    }
  });

  // Function to read Bluetooth data
  async function readBluetoothData() {
    try {
      const value = await characteristic.readValue();
      console.log('Received Bluetooth data: ', value);
      
      // Decode the received value and display the pulse rate
      const pulseRate = new TextDecoder().decode(value).trim();
      document.getElementById('pulseRate').textContent = pulseRate;
    } catch (error) {
      console.error('Error reading from Bluetooth characteristic: ', error);
    }
  }
</script>

</body>
</html>
